query GetNotebook($id: uuid!, $eventsStart: timestamptz, $eventsEnd: timestamptz) {
	notebook: notebook_by_pk(id: $id) {
		id
		workSituationDate
		workSituation
		rightRsa
		rightRqth
		rightAre
		rightAss
		rightBonus
		geographicalArea
		educationLevel
		contractType
		contractSignDate
		wantedJobs {
			rome_code {
				id
				label
			}
		}
		beneficiary {
			address1
			address2
			cafNumber
			city
			dateOfBirth
			email
			firstname
			id
			lastname
			mobileNumber
			peNumber
			postalCode
		}
		focuses(order_by: { theme: asc_nulls_last }) {
			id
			theme
			situations
			linkedTo
			targets {
				id
				target
        actions_aggregate(where: {status: {_eq: "in_progress"}}) {
					aggregate {
						count
					}
				}
			}
		}
		members(order_by: { lastModifiedAt: desc_nulls_last }) {
			id
			memberType
			lastModifiedAt
			lastVisitedAt
			createdAt
			professional {
				id
				lastname
				firstname
				position
				email
				mobileNumber
				structure {
					id
					name
					address1
					address2
					postalCode
					city
					website
				}
			}
		}
		events(
			order_by: { eventDate: desc_nulls_first }
			where: { eventDate: { _gte: $eventsStart, _lte: $eventsEnd } }
		) {
			...eventFields
		}
	}
}

query GetNotebookEvents($eventsStart: timestamptz, $eventsEnd: timestamptz, $notebookId: uuid!) {
	notebook_event(
		order_by: { eventDate: desc_nulls_last }
		where: { eventDate: { _gte: $eventsStart, _lte: $eventsEnd }, notebookId: { _eq: $notebookId } }
	) {
		...eventFields
	}
}

fragment eventFields on notebook_event {
	id
	eventDate
	event
	eventType
	professionalId
	professional {
		structureId
		structure {
			name
		}
	}
}
